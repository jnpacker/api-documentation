{
  "kind": "KlusterletConfig",
  "apiVersion": "config.open-cluster-management.io/v1alpha1",
  "metadata": {
    "group": "config.open-cluster-management.io",
    "version": "v1alpha1",
    "plural": "klusterletconfigs",
    "singular": "klusterletconfig",
    "scope": "Cluster"
  },
  "spec": {
    "description": "Spec defines the desired state of KlusterletConfig",
    "fields": {
      "appliedManifestWorkEvictionGracePeriod": {
        "type": "string",
        "description": "AppliedManifestWorkEvictionGracePeriod is the eviction grace period the work agent will wait before\nevicting the AppliedManifestWorks, whose corresponding ManifestWorks are missing on the hub cluster, from\nthe managed cluster. If not present, the default value of the work agent will be used. If its value is\nset to \"INFINITE\", it means the AppliedManifestWorks will never been evicted from the managed cluster.",
        "validations": {
          "pattern": "^([0-9]+(s|m|h))+$|^INFINITE$"
        }
      },
      "clusterClaimConfiguration": {
        "type": "object",
        "description": "ClusterClaimConfiguration represents the configuration of ClusterClaim\nEffective only when the `ClusterClaim` feature gate is enabled.",
        "fields": {
          "maxCustomClusterClaims": {
            "type": "integer",
            "description": "Maximum number of custom ClusterClaims allowed.",
            "required": true,
            "default": 20,
            "validations": {
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      },
      "featureGates": {
        "type": "array",
        "description": "FeatureGates is the list of feature gate for the klusterlet agent.\nIf it is set empty, default feature gates will be used.",
        "fields": {
          "feature": {
            "type": "string",
            "description": "Feature is the key of feature gate. e.g. featuregate/Foo.",
            "required": true
          },
          "mode": {
            "type": "string",
            "description": "Mode is either Enable, Disable, \"\" where \"\" is Disable by default.\nIn Enable mode, a valid feature gate `featuregate/Foo` will be set to \"--featuregate/Foo=true\".\nIn Disable mode, a valid feature gate `featuregate/Foo` will be set to \"--featuregate/Foo=false\".",
            "enum": [
              "Enable",
              "Disable"
            ],
            "default": "Disable"
          }
        }
      },
      "hubKubeAPIServerCABundle": {
        "type": "string",
        "description": "HubKubeAPIServerCABundle is the CA bundle to verify the server certificate of the hub kube API\nagainst. If not present, CA bundle will be determined with the logic below:\n1). Use the certificate of the named certificate configured in APIServer/cluster if FQDN matches;\n2). Otherwise use the CA certificates from kube-root-ca.crt ConfigMap in the cluster namespace;\nDeprecated and maintained for backward compatibility, use HubKubeAPIServerConfig.ServerVarificationStrategy\nand HubKubeAPIServerConfig.TrustedCABundles instead"
      },
      "hubKubeAPIServerConfig": {
        "type": "object",
        "description": "HubKubeAPIServerConfig specifies the settings required for connecting to the hub Kube API server.\nIf this field is present, the below deprecated fields will be ignored:\n- HubKubeAPIServerProxyConfig\n- HubKubeAPIServerURL\n- HubKubeAPIServerCABundle",
        "fields": {
          "proxyURL": {
            "type": "string",
            "description": "ProxyURL is the URL to the proxy to be used for all requests made by client\nIf an HTTPS proxy server is configured, you may also need to add the necessary CA certificates to\nTrustedCABundles."
          },
          "serverVerificationStrategy": {
            "type": "string",
            "description": "ServerVerificationStrategy is the strategy used for verifying the server certification;\nThe value could be \"UseSystemTruststore\", \"UseAutoDetectedCABundle\", \"UseCustomCABundles\", empty.\nWhen this strategy is not set or value is empty; if there is only one klusterletConfig configured for a cluster,\nthe strategy is eaual to \"UseAutoDetectedCABundle\", if there are more than one klusterletConfigs, the empty\nstrategy will be overrided by other non-empty strategies.",
            "enum": [
              "UseSystemTruststore",
              "UseAutoDetectedCABundle",
              "UseCustomCABundles"
            ]
          },
          "trustedCABundles": {
            "type": "array",
            "description": "TrustedCABundles refers to a collection of user-provided CA bundles used for verifying the server\ncertificate of the hub Kubernetes API\nIf the ServerVerificationStrategy is set to \"UseSystemTruststore\", this field will be ignored.\nOtherwise, the CA certificates from the configured bundles will be appended to the klusterlet CA bundle.",
            "fields": {
              "caBundle": {
                "type": "object",
                "description": "CABundle refers to a ConfigMap with label \"import.open-cluster-management.io/ca-bundle\"\ncontaining the user-provided CA bundle\nThe key of the CA data could be \"ca-bundle.crt\", \"ca.crt\", or \"tls.crt\".",
                "required": true,
                "fields": {
                  "name": {
                    "type": "string",
                    "description": "name is the metadata.name of the referenced config map",
                    "required": true
                  },
                  "namespace": {
                    "type": "string",
                    "description": "name is the metadata.namespace of the referenced config map",
                    "required": true
                  }
                }
              },
              "name": {
                "type": "string",
                "description": "Name is the identifier used to reference the CA bundle; Do not use \"auto-detected\" as the name\nsince it is the reserved name for the auto-detected CA bundle.",
                "required": true
              }
            }
          },
          "url": {
            "type": "string",
            "description": "URL is the endpoint of the hub Kube API server.\nIf not present, the .status.apiServerURL of Infrastructure/cluster will be used as the default value.\ne.g. `oc get infrastructure cluster -o jsonpath='{.status.apiServerURL}'`"
          }
        }
      },
      "hubKubeAPIServerProxyConfig": {
        "type": "object",
        "description": "HubKubeAPIServerProxyConfig holds proxy settings for connections between klusterlet/add-on agents\non the managed cluster and the kube-apiserver on the hub cluster.\nEmpty means no proxy settings is available.\nDeprecated and maintained for backward compatibility, use HubKubeAPIServerConfig.ProxyURL instead",
        "fields": {
          "caBundle": {
            "type": "string",
            "description": "CABundle is a CA certificate bundle to verify the proxy server.\nIt will be ignored if only HTTPProxy is set;\nAnd it is required when HTTPSProxy is set and self signed CA certificate is used\nby the proxy server."
          },
          "httpProxy": {
            "type": "string",
            "description": "HTTPProxy is the URL of the proxy for HTTP requests"
          },
          "httpsProxy": {
            "type": "string",
            "description": "HTTPSProxy is the URL of the proxy for HTTPS requests\nHTTPSProxy will be chosen if both HTTPProxy and HTTPSProxy are set."
          }
        }
      },
      "hubKubeAPIServerURL": {
        "type": "string",
        "description": "HubKubeAPIServerURL is the URL of the hub Kube API server.\nIf not present, the .status.apiServerURL of Infrastructure/cluster will be used as the default value.\ne.g. `oc get infrastructure cluster -o jsonpath='{.status.apiServerURL}'`\nDeprecated and maintained for backward compatibility, use HubKubeAPIServerConfig.URL instead"
      },
      "installMode": {
        "type": "object",
        "description": "InstallMode is the mode to install the klusterlet",
        "fields": {
          "noOperator": {
            "type": "object",
            "description": "NoOperator is the setting of klusterlet installation when install type is noOperator.",
            "fields": {
              "postfix": {
                "type": "string",
                "description": "Postfix is the postfix of the klusterlet name. The name of the klusterlet is \"klusterlet\" if\nit is not set, and \"klusterlet-{Postfix}\". The install namespace is \"open-cluster-management-agent\"\nif it is not set, and \"open-cluster-management-{Postfix}\".",
                "validations": {
                  "pattern": "^[-a-z0-9]*[a-z0-9]$"
                }
              }
            }
          },
          "type": {
            "type": "string",
            "description": "InstallModeType is the type of install mode.",
            "enum": [
              "default",
              "noOperator"
            ],
            "default": "default"
          }
        }
      },
      "multipleHubsConfig": {
        "type": "object",
        "description": "MultipleHubsConfig contains configuration specific to multiple hub scenarios",
        "fields": {
          "bootstrapKubeConfigs": {
            "type": "object",
            "description": "BootstrapKubeConfigs is the list of bootstrap kubeconfigs for multiple hubs",
            "fields": {
              "localSecretsConfig": {
                "type": "object",
                "description": "LocalSecretsConfig include a list of secrets that contains the kubeconfigs for ordered bootstrap kubeconifigs.\nThe secrets must be in the same namespace where the agent controller runs.",
                "fields": {
                  "hubConnectionTimeoutSeconds": {
                    "type": "integer",
                    "description": "HubConnectionTimeoutSeconds is used to set the timeout of connecting to the hub cluster.\nWhen agent loses the connection to the hub over the timeout seconds, the agent do a rebootstrap.\nBy default is 10 mins.",
                    "default": 600,
                    "validations": {
                      "minimum": 180
                    }
                  },
                  "kubeConfigSecrets": {
                    "type": "array",
                    "description": "KubeConfigSecrets is a list of secret names. The secrets are in the same namespace where the agent controller runs.",
                    "required": true,
                    "fields": {
                      "name": {
                        "type": "string",
                        "description": "Name is the name of the secret.",
                        "required": true
                      }
                    }
                  }
                }
              },
              "type": {
                "type": "string",
                "description": "Type specifies the type of priority bootstrap kubeconfigs.\nBy default, it is set to None, representing no priority bootstrap kubeconfigs are set.",
                "required": true,
                "enum": [
                  "None",
                  "LocalSecrets"
                ],
                "default": "None"
              }
            }
          },
          "genBootstrapKubeConfigStrategy": {
            "type": "string",
            "description": "GenBootstrapKubeConfigStrategy controls the strategy for generating bootstrap kubeconfig files.\nDefault - Generate bootstrap kubeconfigs only with the BootstrapKubeConfigs configured in KlusterletConfig.\nIncludeCurrentHub - When generating bootstrap kubeconfigs, automatically include the current hub's kubeconfig.",
            "enum": [
              "Default",
              "IncludeCurrentHub"
            ],
            "default": "Default"
          }
        }
      },
      "nodePlacement": {
        "type": "object",
        "description": "NodePlacement enables explicit control over the scheduling of the agent components.\nIf the placement is nil, the placement is not specified, it will be omitted.\nIf the placement is an empty object, the placement will match all nodes and tolerate nothing.",
        "fields": {
          "nodeSelector": {
            "type": "object",
            "description": "NodeSelector defines which Nodes the Pods are scheduled on. The default is an empty list."
          },
          "tolerations": {
            "type": "array",
            "description": "Tolerations are attached by pods to tolerate any taint that matches\nthe triple <key,value,effect> using the matching operator <operator>.\nThe default is an empty list.",
            "fields": {
              "effect": {
                "type": "string",
                "description": "Effect indicates the taint effect to match. Empty means match all taint effects.\nWhen specified, allowed values are NoSchedule, PreferNoSchedule and NoExecute."
              },
              "key": {
                "type": "string",
                "description": "Key is the taint key that the toleration applies to. Empty means match all taint keys.\nIf the key is empty, operator must be Exists; this combination means to match all values and all keys."
              },
              "operator": {
                "type": "string",
                "description": "Operator represents a key's relationship to the value.\nValid operators are Exists and Equal. Defaults to Equal.\nExists is equivalent to wildcard for value, so that a pod can\ntolerate all taints of a particular category."
              },
              "tolerationSeconds": {
                "type": "integer",
                "description": "TolerationSeconds represents the period of time the toleration (which must be\nof effect NoExecute, otherwise this field is ignored) tolerates the taint. By default,\nit is not set, which means tolerate the taint forever (do not evict). Zero and\nnegative values will be treated as 0 (evict immediately) by the system."
              },
              "value": {
                "type": "string",
                "description": "Value is the taint value the toleration matches to.\nIf the operator is Exists, the value should be empty, otherwise just a regular string."
              }
            }
          }
        }
      },
      "pullSecret": {
        "type": "object",
        "description": "PullSecret is the name of image pull secret.",
        "fields": {
          "apiVersion": {
            "type": "string",
            "description": "API version of the referent."
          },
          "fieldPath": {
            "type": "string",
            "description": "If referring to a piece of an object instead of an entire object, this string\nshould contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].\nFor example, if the object reference is to a container within a pod, this would take on a value like:\n\"spec.containers{name}\" (where \"name\" refers to the name of the container that triggered\nthe event) or if no container name is specified \"spec.containers[2]\" (container with\nindex 2 in this pod). This syntax is chosen only to have some well-defined way of\nreferencing a part of an object."
          },
          "kind": {
            "type": "string",
            "description": "Kind of the referent.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds"
          },
          "name": {
            "type": "string",
            "description": "Name of the referent.\nMore info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names"
          },
          "namespace": {
            "type": "string",
            "description": "Namespace of the referent.\nMore info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/"
          },
          "resourceVersion": {
            "type": "string",
            "description": "Specific resourceVersion to which this reference is made, if any.\nMore info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency"
          },
          "uid": {
            "type": "string",
            "description": "UID of the referent.\nMore info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids"
          }
        }
      },
      "registries": {
        "type": "array",
        "description": "Registries includes the mirror and source registries. The source registry will be replaced by the Mirror.",
        "fields": {
          "mirror": {
            "type": "string",
            "description": "Mirror is the mirrored registry of the Source. Will be ignored if Mirror is empty.",
            "required": true
          },
          "source": {
            "type": "string",
            "description": "Source is the source registry. All image registries will be replaced by Mirror if Source is empty."
          }
        }
      }
    }
  },
  "status": {
    "description": "Status defines the observed state of KlusterletConfig",
    "fields": {}
  },
  "exampleYAML": "apiVersion: config.open-cluster-management.io/v1alpha1\nkind: KlusterletConfig\nmetadata:\n  name: example-klusterletconfig\nspec:\n  appliedManifestWorkEvictionGracePeriod: \"example-appliedManifestWorkEvictionGracePeriod\"\n  clusterClaimConfiguration: {}\n  featureGates: []\n  hubKubeAPIServerCABundle: \"example-hubKubeAPIServerCABundle\"\n  hubKubeAPIServerConfig: {}\n"
}